<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://stackedit.io/res-min/themes/base.css" />
<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
<script>e
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-88637530-1', 'auto');
  ga('send', 'pageview');
</script>
</head>

<body><div class="container" width="70%"><p></p><center><img src="https://k61.kn3.net/4/6/F/B/B/2/02D.png" alt="" title=""> </center><p></p>

<table align="center"><tbody><tr>
<td><a href="http://gcristian.github.io/minka">Home</a></td>
<td><a href="http://gcristian.github.io/minka/doc/site/integration.html">Integration</a></td>
<td><a href="http://gcristian.github.io/minka/doc/site/details.html">Details</a></td>
<td><a href="http://gcristian.github.io/minka/doc/site/architecture.html">Architecture</a></td>
<td><a href="http://gcristian.github.io/minka/doc/site/project.html">Project</a></td>
</tr></tbody></table>



<h3 id="1-integration">1. Integration</h3>

<p>Project repository: <a href="https://github.com/gcristian/minka">https://github.com/gcristian/minka</a></p>



<h4 id="11-artifact">1.1 Artifact</h4>

<pre><code>&lt;dependency&gt;
    &lt;artifactId&gt;minka-parent&lt;/artifactId&gt;
    &lt;groupId&gt;io.tilt.minka&lt;/groupId&gt;
    &lt;version&gt;0.2-SNAPSHOT&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>



<h4 id="12-requirements">1.2 Requirements</h4>

<ul>
<li>a Zookeeper cluster, used for leader election.</li>
<li>a host JVM system, where the server runs embedded.</li>
</ul>



<h4 id="12-library">1.2 Library</h4>

<p>Minka provides a compact API at <code>io.tilt.minka.api</code> to do really few things:</p>

<ul>
<li>class <code>DutyBuilder/PalletBuilder</code> to wrap and internalize user entities</li>
<li>class <code>MinkaClient</code> to input CRUD duties &amp; pallets, after first balance.</li>
<li>class <code>Minka</code> to start the server and listen for events.</li>
</ul>



<h4 id="13-events">1.3 Events</h4>

<p>Minka is designed to embrace incidents, that unfolds an event-driven architecture, which also applies its API.  <br>
These are the events the client must listen and react to:</p>

<table>
<thead>
<tr>
  <th align="left">event type</th>
  <th>required</th>
  <th>when</th>
  <th>what for</th>
</tr>
</thead>
<tbody><tr>
  <td align="left"><code>load</code></td>
  <td>yes</td>
  <td>balance *phase</td>
  <td>enter the initial duties and pallets to minka, only called at the first balancing phase of a new elected leader.</td>
</tr>
<tr>
  <td align="left"><code>capture</code>, <code>release</code></td>
  <td>yes</td>
  <td>distribution phase</td>
  <td>honour the <em>Inversion of Control</em> contract: take or discard duties and pallets (start or stop user tasks)</td>
</tr>
<tr>
  <td align="left"><code>report</code></td>
  <td>yes</td>
  <td>proctor phase</td>
  <td>return the passed and currently captured duties, in permanent custody</td>
</tr>
<tr>
  <td align="left"><code>update</code>, <code>transfer</code></td>
  <td>no</td>
  <td>anytime</td>
  <td>reaction of a duty or pallet’s payload update or a transferred message, to a duty or pallet previously <em>captured</em></td>
</tr>
</tbody></table>


<p>*see the phases in the architecture section.</p>



<h4 id="14-sample">1.4 Sample</h4>

<p>This creates a Minka server shard, starting with 1 pallet with a fair weight balancer, and 1 duty  weighing 200. When Minka yields control of the duty to us: we simply add it to <em>myDuties</em> set. <br>
In a real use case all application instances must reuse the same routine and behave identically approaching Minka.</p>

<iframe height="320px" width="100%" src="//pastebin.com/embed_iframe/M1riEVYV"></iframe>

<p>Every Minka class instance is a <em>Shard</em>, and can define which cluster is member of, by default is <em>unnamed</em>. In case we plan to share the zookeeper cluster with other minka-enabled applications: we must provide a custom name, or use a zookeeper’s chroot folder. </p>

<p>Every JVM should only have one member, only for testing we could specify different TCP ports, and under the same cluster name (<em>unnamed</em> is fine) or zk’s chroot folder: we’ll have a “standalone” cluster, communicating thru loopback interfase.</p>

<iframe width="100%" height="170px" src="//pastebin.com/embed_iframe/VTydemdM"></iframe>

<h4 id="15-operations">1.5 Operations</h4>

<blockquote>
  <p>As in current version Minka lacks of a distributed-transactional storage, CRUD requests operate only in the current leader’s lifecycle. At the event of a new leader reelection, all previous CRUD requests rely on their inclusion in the suppliers provided at the new elected leader, in the events <code>onPalletLoad</code> and <code>onDutyLoad</code>.</p>
</blockquote>

<p>These are the CRUD requests that can be performed thru <code>io.tilt.minka.api.MinkaClient</code> class:</p>

<table>
<thead>
<tr>
  <th>method</th>
  <th>action</th>
</tr>
</thead>
<tbody><tr>
  <td>add</td>
  <td>adds a new pallet or duty to the system, in order for a shard to capture it and process it.</td>
</tr>
<tr>
  <td>remove</td>
  <td>remove an existing pallet or duty, for the shard that captured it: to release it.</td>
</tr>
<tr>
  <td>update</td>
  <td>update the pallet or duty payload at the shard held in custody</td>
</tr>
<tr>
  <td>transfer</td>
  <td>send a message to a pallet or duty, at the shard held in custody</td>
</tr>
</tbody></table>




<h4 id="1-6-sample">1. 6 Sample</h4>

<p>This enters a newly created duty to the system, on the same existing pallet, and removes the previous one.</p>



<pre class="prettyprint prettyprinted"><code class="language-java"><span class="typ">MinkaClient</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> cli </span><span class="pun">=</span><span class="pln"> server</span><span class="pun">.</span><span class="pln">getClient</span><span class="pun">();</span><span class="pln">
cli</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="typ">DutyBuilder</span><span class="pun">.&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln">builder</span><span class="pun">(</span><span class="str">"other"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"pal"</span><span class="pun">).</span><span class="pln">build</span><span class="pun">());</span><span class="pln">
cli</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span><span class="pln">aDuty</span><span class="pun">);</span></code></pre>



<h3 id="2-limitations">2. Limitations</h3>

<ul>
<li>Minka lacks of a storage of its own in the *current version, for duties, pallets and CRUD requests, the client must use a database to store input data, in case a new leader reelection occurrs (prepare for it),  because all elements beside those loaded at first: are held in memory by the leader itself. </li>
<li>every minka host application must behave identically, they run code that reacts to duties.</li>
<li>host layer ignores distribution plumbing, states and environment, cannot rely on physical resources on the machine it runs.</li>
</ul>

<p>What happens if your application is not subtled to process granularity ?</p>

<ul>
<li>Leaving out cases of bad modularization, scattered components or cluttered layers, big-coarsed grained applications arent good candidates for Minka integration, as we rely on it for external input of data or signals, and their balanced distribution for our own processing purposes. </li>
</ul>

<p>*see the roadmap</p>



<h3 id="3-demo">3. Demo</h3>

<p>The demo application allows testing of a distributed stage, communication goes thru loopback interfase.</p>

<p>Checkout the source repository:</p>



<pre class="prettyprint prettyprinted"><code><span class="pln">$ git checkout git@github</span><span class="pun">.</span><span class="pln">com</span><span class="pun">:</span><span class="pln">gcristian</span><span class="pun">/</span><span class="pln">minka</span><span class="pun">.</span><span class="pln">git
$ ls
drwxrwxr</span><span class="pun">-</span><span class="pln">x </span><span class="lit">2</span><span class="pln"> cristian cristian </span><span class="lit">4</span><span class="pun">,</span><span class="lit">0K</span><span class="pln"> dic  </span><span class="lit">9</span><span class="pln"> </span><span class="lit">21</span><span class="pun">:</span><span class="lit">59</span><span class="pln"> doc
</span><span class="pun">-</span><span class="pln">rwxrwxr</span><span class="pun">-</span><span class="pln">x </span><span class="lit">1</span><span class="pln"> cristian cristian   </span><span class="lit">38</span><span class="pln"> dic  </span><span class="lit">9</span><span class="pln"> </span><span class="lit">02</span><span class="pun">:</span><span class="lit">32</span><span class="pln"> go
</span><span class="pun">-</span><span class="pln">rw</span><span class="pun">-</span><span class="pln">rw</span><span class="pun">-</span><span class="pln">r</span><span class="pun">--</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> cristian cristian  </span><span class="lit">12K</span><span class="pln"> dic  </span><span class="lit">9</span><span class="pln"> </span><span class="lit">02</span><span class="pun">:</span><span class="lit">32</span><span class="pln"> LICENSE
drwxrwxr</span><span class="pun">-</span><span class="pln">x </span><span class="lit">6</span><span class="pln"> cristian cristian </span><span class="lit">4</span><span class="pun">,</span><span class="lit">0K</span><span class="pln"> dic  </span><span class="lit">9</span><span class="pln"> </span><span class="lit">02</span><span class="pun">:</span><span class="lit">32</span><span class="pln"> samples
drwxrwxr</span><span class="pun">-</span><span class="pln">x </span><span class="lit">3</span><span class="pln"> cristian cristian </span><span class="lit">4</span><span class="pun">,</span><span class="lit">0K</span><span class="pln"> dic  </span><span class="lit">9</span><span class="pln"> </span><span class="lit">02</span><span class="pun">:</span><span class="lit">32</span><span class="pln"> server
drwxrwxr</span><span class="pun">-</span><span class="pln">x </span><span class="lit">5</span><span class="pln"> cristian cristian </span><span class="lit">4</span><span class="pun">,</span><span class="lit">0K</span><span class="pln"> dic  </span><span class="lit">9</span><span class="pln"> </span><span class="lit">02</span><span class="pun">:</span><span class="lit">32</span><span class="pln"> spectator
</span><span class="pun">-</span><span class="pln">rw</span><span class="pun">-</span><span class="pln">rw</span><span class="pun">-</span><span class="pln">r</span><span class="pun">--</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> cristian cristian </span><span class="lit">2</span><span class="pun">,</span><span class="lit">3K</span><span class="pln"> dic  </span><span class="lit">9</span><span class="pln"> </span><span class="lit">21</span><span class="pun">:</span><span class="lit">59</span><span class="pln"> readme</span><span class="pun">.</span><span class="pln">md
</span><span class="pun">-</span><span class="pln">rw</span><span class="pun">-</span><span class="pln">rw</span><span class="pun">-</span><span class="pln">r</span><span class="pun">--</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> cristian cristian </span><span class="lit">4</span><span class="pun">,</span><span class="lit">5K</span><span class="pln"> dic  </span><span class="lit">9</span><span class="pln"> </span><span class="lit">02</span><span class="pun">:</span><span class="lit">32</span><span class="pln"> pom</span><span class="pun">.</span><span class="pln">xml</span></code></pre>

<p>We have the core at <code>../server</code>, and the demo application at <code>../samples</code> <br>
The demo app. is launched with the <code>newsampler.sh</code> script.</p>



<pre class="prettyprint prettyprinted"><code><span class="pln">$ cd samples
$ ls

drwxrwxr</span><span class="pun">-</span><span class="pln">x </span><span class="lit">2</span><span class="pln"> cristian cristian </span><span class="lit">4</span><span class="pun">,</span><span class="lit">0K</span><span class="pln"> dic  </span><span class="lit">9</span><span class="pln"> </span><span class="lit">02</span><span class="pun">:</span><span class="lit">32</span><span class="pln"> datasets
</span><span class="pun">-</span><span class="pln">rwxrwxr</span><span class="pun">-</span><span class="pln">x </span><span class="lit">1</span><span class="pln"> cristian cristian  </span><span class="lit">823</span><span class="pln"> oct </span><span class="lit">30</span><span class="pln"> </span><span class="lit">17</span><span class="pun">:</span><span class="lit">12</span><span class="pln"> sampler
drwxrwxr</span><span class="pun">-</span><span class="pln">x </span><span class="lit">4</span><span class="pln"> cristian cristian </span><span class="lit">4</span><span class="pun">,</span><span class="lit">0K</span><span class="pln"> ago </span><span class="lit">21</span><span class="pln"> </span><span class="lit">20</span><span class="pun">:</span><span class="lit">22</span><span class="pln"> src
drwxrwxr</span><span class="pun">-</span><span class="pln">x </span><span class="lit">7</span><span class="pln"> cristian cristian </span><span class="lit">4</span><span class="pun">,</span><span class="lit">0K</span><span class="pln"> nov </span><span class="lit">26</span><span class="pln"> </span><span class="lit">21</span><span class="pun">:</span><span class="lit">50</span><span class="pln"> target
</span><span class="pun">-</span><span class="pln">rwxrwxr</span><span class="pun">-</span><span class="pln">x </span><span class="lit">1</span><span class="pln"> cristian cristian  </span><span class="lit">853</span><span class="pln"> dic  </span><span class="lit">9</span><span class="pln"> </span><span class="lit">02</span><span class="pun">:</span><span class="lit">32</span><span class="pln"> newsampler</span><span class="pun">.</span><span class="pln">sh
</span><span class="pun">-</span><span class="pln">rw</span><span class="pun">-</span><span class="pln">rw</span><span class="pun">-</span><span class="pln">r</span><span class="pun">--</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> cristian cristian </span><span class="lit">4</span><span class="pun">,</span><span class="lit">1K</span><span class="pln"> dic  </span><span class="lit">9</span><span class="pln"> </span><span class="lit">02</span><span class="pun">:</span><span class="lit">32</span><span class="pln"> pom</span><span class="pun">.</span><span class="pln">xml

$ cat newsampler</span><span class="pun">.</span><span class="pln">sh</span></code></pre>

<iframe width="100%" height="500px" src="//pastebin.com/embed_iframe/mMvXCe4s"></iframe>



<h4 id="emulated-scenario">Emulated scenario</h4>

<p>The script basically tests available ports starting from 9000, and runs a Java process with a data set file as a parameter.</p>

<blockquote>
  <p>Maven 3.x installed is required.</p>
</blockquote>

<p>A Dataset file contains intructions about the stage we are simulating: </p>

<ul>
<li>size of total duties, number of concurrent shards</li>
<li>pallets with their weights, balancer, and their slice of duties</li>
<li>the pallet weight capacity that each shard will report (they will look for the one with its own port)</li>
</ul>

<p>We’ll be using <code>mix.properties</code> which has an heterogeneous stage:</p>



<pre class="prettyprint prettyprinted"><code><span class="pln">$ ls
</span><span class="pun">-</span><span class="pln">rw</span><span class="pun">-</span><span class="pln">rw</span><span class="pun">-</span><span class="pln">r</span><span class="pun">--</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> cristian cristian  </span><span class="lit">331</span><span class="pln"> dic  </span><span class="lit">9</span><span class="pln"> </span><span class="lit">02</span><span class="pun">:</span><span class="lit">32</span><span class="pln"> dataset</span><span class="pun">-</span><span class="pln">cluster1</span><span class="pun">.</span><span class="pln">properties
</span><span class="pun">-</span><span class="pln">rw</span><span class="pun">-</span><span class="pln">rw</span><span class="pun">-</span><span class="pln">r</span><span class="pun">--</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> cristian cristian  </span><span class="lit">331</span><span class="pln"> dic  </span><span class="lit">9</span><span class="pln"> </span><span class="lit">02</span><span class="pun">:</span><span class="lit">32</span><span class="pln"> dataset</span><span class="pun">-</span><span class="pln">cluster2</span><span class="pun">.</span><span class="pln">properties
</span><span class="pun">-</span><span class="pln">rw</span><span class="pun">-</span><span class="pln">rw</span><span class="pun">-</span><span class="pln">r</span><span class="pun">--</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> cristian cristian  </span><span class="lit">351</span><span class="pln"> dic  </span><span class="lit">9</span><span class="pln"> </span><span class="lit">02</span><span class="pun">:</span><span class="lit">32</span><span class="pln"> dataset</span><span class="pun">.</span><span class="pln">properties
</span><span class="pun">-</span><span class="pln">rw</span><span class="pun">-</span><span class="pln">rw</span><span class="pun">-</span><span class="pln">r</span><span class="pun">--</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> cristian cristian  </span><span class="lit">155</span><span class="pln"> dic  </span><span class="lit">9</span><span class="pln"> </span><span class="lit">02</span><span class="pun">:</span><span class="lit">32</span><span class="pln"> dataset</span><span class="pun">-</span><span class="pln">sizy</span><span class="pun">.</span><span class="pln">properties
</span><span class="pun">-</span><span class="pln">rw</span><span class="pun">-</span><span class="pln">rw</span><span class="pun">-</span><span class="pln">r</span><span class="pun">--</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> cristian cristian  </span><span class="lit">177</span><span class="pln"> dic  </span><span class="lit">9</span><span class="pln"> </span><span class="lit">02</span><span class="pun">:</span><span class="lit">32</span><span class="pln"> fairy</span><span class="pun">.</span><span class="pln">properties
</span><span class="pun">-</span><span class="pln">rw</span><span class="pun">-</span><span class="pln">rw</span><span class="pun">-</span><span class="pln">r</span><span class="pun">--</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> cristian cristian  </span><span class="lit">740</span><span class="pln"> dic  </span><span class="lit">9</span><span class="pln"> </span><span class="lit">02</span><span class="pun">:</span><span class="lit">32</span><span class="pln"> mix</span><span class="pun">.</span><span class="pln">properties
</span><span class="pun">-</span><span class="pln">rw</span><span class="pun">-</span><span class="pln">rw</span><span class="pun">-</span><span class="pln">r</span><span class="pun">--</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> cristian cristian </span><span class="lit">2</span><span class="pun">,</span><span class="lit">2K</span><span class="pln"> dic  </span><span class="lit">9</span><span class="pln"> </span><span class="lit">02</span><span class="pun">:</span><span class="lit">32</span><span class="pln"> sample</span><span class="pun">.</span><span class="pln">properties

$ cat datasets</span><span class="pun">/</span><span class="pln">mix</span><span class="pun">.</span><span class="pln">properties

duties</span><span class="pun">.</span><span class="pln">size </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1000</span><span class="pln">
shards</span><span class="pun">.</span><span class="pln">ports </span><span class="pun">=</span><span class="pln"> </span><span class="lit">9001</span><span class="pun">;</span><span class="lit">9002</span><span class="pun">;</span><span class="lit">9000</span><span class="pln">
duties</span><span class="pun">.</span><span class="pln">pallets </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Finwe</span><span class="pun">:</span><span class="lit">200</span><span class="pun">:</span><span class="lit">50</span><span class="pun">~</span><span class="lit">100</span><span class="pun">:</span><span class="pln">FAIR_WEIGHT</span><span class="pun">;</span><span class="pln"> </span><span class="typ">Ewok</span><span class="pun">:</span><span class="lit">500</span><span class="pun">:</span><span class="lit">500</span><span class="pun">~</span><span class="lit">1000</span><span class="pun">:</span><span class="pln">EVEN_WEIGHT</span><span class="pun">;</span><span class="pln"> </span><span class="typ">Cirith</span><span class="pun">:</span><span class="lit">100</span><span class="pun">:</span><span class="lit">1</span><span class="pun">:</span><span class="pln">EVEN_SIZE</span><span class="pun">;</span><span class="pln"> </span><span class="typ">Manwe</span><span class="pun">:</span><span class="lit">150</span><span class="pun">:</span><span class="lit">50</span><span class="pun">~</span><span class="lit">1000</span><span class="pun">:</span><span class="pln">FAIR_WEIGHT</span><span class="pun">;</span><span class="pln">
shards</span><span class="pun">.</span><span class="pln">capacities </span><span class="pun">=</span><span class="pln"> </span><span class="lit">9001</span><span class="pun">:</span><span class="typ">Finwe</span><span class="pun">:</span><span class="lit">1000</span><span class="pun">;</span><span class="pln"> </span><span class="lit">9001</span><span class="pun">:</span><span class="typ">Ewok</span><span class="pun">:</span><span class="lit">3000</span><span class="pun">;</span><span class="pln"> </span><span class="lit">9001</span><span class="pun">:</span><span class="typ">Manwe</span><span class="pun">:</span><span class="lit">25000</span><span class="pun">;</span><span class="pln"> </span><span class="lit">9002</span><span class="pun">:</span><span class="typ">Finwe</span><span class="pun">:</span><span class="lit">1500</span><span class="pun">;</span><span class="pln"> </span><span class="lit">9002</span><span class="pun">:</span><span class="typ">Ewok</span><span class="pun">:</span><span class="lit">2000</span><span class="pun">;</span><span class="pln"> </span><span class="lit">9002</span><span class="pun">:</span><span class="typ">Manwe</span><span class="pun">:</span><span class="lit">11000</span><span class="pun">;</span><span class="pln"> </span><span class="lit">9000</span><span class="pun">:</span><span class="typ">Finwe</span><span class="pun">:</span><span class="lit">15000</span><span class="pun">;</span><span class="pln"> </span><span class="lit">9000</span><span class="pun">:</span><span class="typ">Ewok</span><span class="pun">:</span><span class="lit">24000</span><span class="pun">;</span><span class="pln"> </span><span class="lit">9000</span><span class="pun">:</span><span class="typ">Manwe</span><span class="pun">:</span><span class="lit">16000</span><span class="pun">;</span><span class="pln"> </span><span class="lit">9003</span><span class="pun">:</span><span class="typ">Finwe</span><span class="pun">:</span><span class="lit">15000</span><span class="pun">;</span><span class="pln"> </span><span class="lit">9003</span><span class="pun">:</span><span class="typ">Ewok</span><span class="pun">:</span><span class="lit">35500</span><span class="pun">;</span><span class="pln"> </span><span class="lit">9003</span><span class="pun">:</span><span class="typ">Manwe</span><span class="pun">:</span><span class="lit">45000</span></code></pre>

<p>I will explain some properties: </p>



<pre class="prettyprint prettyprinted"><code><span class="pln">shards</span><span class="pun">.</span><span class="pln">ports </span><span class="pun">=</span><span class="pln"> </span><span class="lit">9001</span><span class="pun">;</span><span class="lit">9002</span><span class="pun">;</span><span class="lit">9000</span></code></pre>

<p>This dataset files requires to launch 3 shards, so we’ll be repeating the same command 3 times:</p>



<pre class="prettyprint prettyprinted"><code><span class="pln">duties</span><span class="pun">.</span><span class="pln">pallets </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Finwe</span><span class="pun">:</span><span class="lit">200</span><span class="pun">:</span><span class="lit">50</span><span class="pun">~</span><span class="lit">100</span><span class="pun">:</span><span class="pln">FAIR_WEIGHT</span><span class="pun">;</span><span class="pln"> </span></code></pre>

<p>A pallet named <em>Finwe</em> will be grabbing <code>200</code> duties, weighing any random number <code>50~100</code>, with the <em>fair weight</em> balancer</p>



<pre class="prettyprint prettyprinted"><code><span class="pln">shards</span><span class="pun">.</span><span class="pln">capacities </span><span class="pun">=</span><span class="pln"> </span><span class="lit">9001</span><span class="pun">:</span><span class="typ">Finwe</span><span class="pun">:</span><span class="lit">1000</span><span class="pun">;</span></code></pre>

<p>The shard that took the port <code>9001</code> first, will report a max weight capacity of <code>1000</code> for pallet Finwe…</p>



<h3 id="lets-go">Let’s go</h3>

<p>Create logging output folders first:</p>



<pre class="prettyprint prettyprinted"><code><span class="pln">$ sudo mkdir </span><span class="pun">/</span><span class="kwd">var</span><span class="pun">/</span><span class="pln">log</span><span class="pun">/</span><span class="pln">minka
$ sudo chown cristian</span><span class="pun">:</span><span class="pln"> </span><span class="str">/var/</span><span class="pln">log</span><span class="pun">/</span><span class="pln">minka</span></code></pre>

<p>Remember to fire the same line in 3 different consoles</p>



<pre class="prettyprint prettyprinted"><code><span class="pln">$ </span><span class="pun">./</span><span class="pln">newsampler datasets</span><span class="pun">/</span><span class="pln">mix</span><span class="pun">.</span><span class="pln">properties</span></code></pre>



<pre class="prettyprint prettyprinted"><code><span class="lit">41</span><span class="pun">:</span><span class="lit">34</span><span class="pln">  INFO </span><span class="pun">(</span><span class="pln">io</span><span class="pun">.</span><span class="pln">tilt</span><span class="pun">.</span><span class="pln">minka</span><span class="pun">.</span><span class="pln">domain</span><span class="pun">.</span><span class="typ">WebServer</span><span class="pun">.</span><span class="pln">main</span><span class="pun">()-</span><span class="typ">EventThread</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Leader</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Registering</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">Leader</span><span class="pln"> at well after waiting </span><span class="lit">46269</span><span class="pln"> msecs
</span><span class="lit">41</span><span class="pun">:</span><span class="lit">34</span><span class="pln">  INFO </span><span class="pun">(</span><span class="pln">io</span><span class="pun">.</span><span class="pln">tilt</span><span class="pun">.</span><span class="pln">minka</span><span class="pun">.</span><span class="pln">domain</span><span class="pun">.</span><span class="typ">WebServer</span><span class="pun">.</span><span class="pln">main</span><span class="pun">()-</span><span class="typ">EventThread</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Leader</span><span class="pun">:</span><span class="pln"> </span><span class="lit">46529</span><span class="pln"> msec since load till leader election
</span><span class="lit">41</span><span class="pun">:</span><span class="lit">34</span><span class="pln">  INFO </span><span class="pun">(</span><span class="pln">io</span><span class="pun">.</span><span class="pln">tilt</span><span class="pun">.</span><span class="pln">minka</span><span class="pun">.</span><span class="pln">domain</span><span class="pun">.</span><span class="typ">WebServer</span><span class="pun">.</span><span class="pln">main</span><span class="pun">()-</span><span class="typ">EventThread</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Proctor</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Starting</span><span class="pun">.</span><span class="pln"> </span><span class="typ">Scheduling</span><span class="pln"> constant shepherding check
</span><span class="lit">41</span><span class="pun">:</span><span class="lit">34</span><span class="pln">  INFO </span><span class="pun">(</span><span class="pln">io</span><span class="pun">.</span><span class="pln">tilt</span><span class="pun">.</span><span class="pln">minka</span><span class="pun">.</span><span class="pln">domain</span><span class="pun">.</span><span class="typ">WebServer</span><span class="pun">.</span><span class="pln">main</span><span class="pun">()-</span><span class="typ">EventThread</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Distributor</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Starting</span><span class="pun">.</span><span class="pln"> </span><span class="typ">Scheduling</span><span class="pln"> constant periodic check
</span><span class="lit">41</span><span class="pun">:</span><span class="lit">34</span><span class="pln">  INFO </span><span class="pun">(</span><span class="pln">io</span><span class="pun">.</span><span class="pln">tilt</span><span class="pun">.</span><span class="pln">minka</span><span class="pun">.</span><span class="pln">domain</span><span class="pun">.</span><span class="typ">WebServer</span><span class="pun">.</span><span class="pln">main</span><span class="pun">()-</span><span class="typ">EventThread</span><span class="pun">)</span><span class="pln"> </span><span class="typ">FollowerEventsHandler</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Starting</span><span class="pun">.</span><span class="pln"> </span><span class="typ">Scheduling</span><span class="pln"> constant shepherding check
</span><span class="lit">41</span><span class="pun">:</span><span class="lit">34</span><span class="pln">  INFO </span><span class="pun">(</span><span class="pln">io</span><span class="pun">.</span><span class="pln">tilt</span><span class="pun">.</span><span class="pln">minka</span><span class="pun">.</span><span class="pln">domain</span><span class="pun">.</span><span class="typ">WebServer</span><span class="pun">.</span><span class="pln">main</span><span class="pun">()-</span><span class="typ">EventThread</span><span class="pun">)</span><span class="pln"> </span><span class="typ">ClientEventsHandler</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Starting</span><span class="pln">
</span><span class="lit">41</span><span class="pun">:</span><span class="lit">35</span><span class="pln">  INFO </span><span class="pun">(</span><span class="pln">MKS</span><span class="pun">-</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬</span><span class="pln"> </span><span class="typ">Analyzing</span><span class="pln"> </span><span class="typ">Shards</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i0</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">by</span><span class="pln"> </span><span class="typ">Leader</span><span class="pun">:</span><span class="pln"> </span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">1.102</span><span class="pun">:</span><span class="lit">9000</span><span class="pln"> </span><span class="pun">▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬</span><span class="pln">
</span><span class="lit">41</span><span class="pun">:</span><span class="lit">35</span><span class="pln">  WARN </span><span class="pun">(</span><span class="pln">MKS</span><span class="pun">-</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Proctor</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Partition</span><span class="pln"> queue empty</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">no</span><span class="pln"> shards emiting heartbeats </span><span class="pun">?</span><span class="pln">
</span><span class="lit">41</span><span class="pun">:</span><span class="lit">35</span><span class="pln">  INFO </span><span class="pun">(</span><span class="pln">MKS</span><span class="pun">-</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————</span><span class="pln">
</span><span class="lit">41</span><span class="pun">:</span><span class="lit">38</span><span class="pln">  INFO </span><span class="pun">(</span><span class="pln">MKS</span><span class="pun">-</span><span class="lit">7</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Stage</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Adding</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Shard</span><span class="pln"> </span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">1.102</span><span class="pun">:</span><span class="lit">9000</span><span class="pln">
</span><span class="lit">41</span><span class="pun">:</span><span class="lit">39</span><span class="pln">  INFO </span><span class="pun">(</span><span class="pln">MKS</span><span class="pun">-</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬</span><span class="pln"> </span><span class="typ">Analyzing</span><span class="pln"> </span><span class="typ">Shards</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i4</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">by</span><span class="pln"> </span><span class="typ">Leader</span><span class="pun">:</span><span class="pln"> </span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">1.102</span><span class="pun">:</span><span class="lit">9000</span><span class="pln"> </span><span class="pun">▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬</span><span class="pln">
</span><span class="lit">41</span><span class="pun">:</span><span class="lit">39</span><span class="pln">  INFO </span><span class="pun">(</span><span class="pln">MKS</span><span class="pun">-</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Proctor</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Health</span><span class="pun">:</span><span class="pln"> STABLE</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> shard</span><span class="pun">(</span><span class="pln">s</span><span class="pun">)</span><span class="pln"> going to be analyzed</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">1.102</span><span class="pun">:</span><span class="lit">9000</span><span class="pun">]</span><span class="pln">
</span><span class="lit">41</span><span class="pun">:</span><span class="lit">39</span><span class="pln">  INFO </span><span class="pun">(</span><span class="pln">MKS</span><span class="pun">-</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Proctor</span><span class="pun">:</span><span class="pln"> </span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">1.102</span><span class="pun">:</span><span class="lit">9000</span><span class="pln"> stays </span><span class="kwd">in</span><span class="pln"> JOINING</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">no</span><span class="pln"> enough heartbeats </span><span class="kwd">in</span><span class="pln"> lapse</span><span class="pun">,</span><span class="pln"> </span><span class="pun">(</span><span class="lit">1</span><span class="pun">/</span><span class="lit">0</span><span class="pun">),</span><span class="pln"> </span><span class="typ">Seq</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1.</span><span class="pun">.</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">❇</span><span class="pln">
</span><span class="lit">41</span><span class="pun">:</span><span class="lit">39</span><span class="pln">  WARN </span><span class="pun">(</span><span class="pln">MKS</span><span class="pun">-</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Proctor</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Cluster</span><span class="pln"> back to</span><span class="pun">:</span><span class="pln"> UNSTABLE </span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> min unchanged analyses</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">
</span><span class="lit">41</span><span class="pun">:</span><span class="lit">39</span><span class="pln">  INFO </span><span class="pun">(</span><span class="pln">MKS</span><span class="pun">-</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————</span></code></pre>

<p>Then whis will happen….</p>



<pre class="prettyprint prettyprinted"><code><span class="pln"> </span><span class="pun">▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬</span><span class="pln"> </span><span class="typ">Analyzing</span><span class="pln"> </span><span class="typ">Shards</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i19</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">by</span><span class="pln"> </span><span class="typ">Leader</span><span class="pun">:</span><span class="pln"> </span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">1.102</span><span class="pun">:</span><span class="lit">9000</span><span class="pln"> </span><span class="pun">▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬</span><span class="pln">
</span><span class="lit">41</span><span class="pun">:</span><span class="lit">54</span><span class="pln">  INFO </span><span class="pun">(</span><span class="pln">MKS</span><span class="pun">-</span><span class="lit">8</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Proctor</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Health</span><span class="pun">:</span><span class="pln"> STABLE</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> shard</span><span class="pun">(</span><span class="pln">s</span><span class="pun">)</span><span class="pln"> going to be analyzed</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">1.102</span><span class="pun">:</span><span class="lit">9000</span><span class="pun">]</span><span class="pln">
</span><span class="lit">41</span><span class="pun">:</span><span class="lit">54</span><span class="pln">  INFO </span><span class="pun">(</span><span class="pln">MKS</span><span class="pun">-</span><span class="lit">8</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Proctor</span><span class="pun">:</span><span class="pln"> </span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">1.102</span><span class="pun">:</span><span class="lit">9000</span><span class="pln"> stays </span><span class="kwd">in</span><span class="pln"> ONLINE</span><span class="pun">,</span><span class="pln"> healthy lapse </span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> min</span><span class="pun">.</span><span class="pln"> healthly </span><span class="kwd">for</span><span class="pln"> online</span><span class="pun">,</span><span class="pln"> </span><span class="pun">(</span><span class="lit">9</span><span class="pun">/</span><span class="lit">9</span><span class="pun">),</span><span class="pln"> </span><span class="typ">Seq</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1.</span><span class="pun">.</span><span class="lit">9</span><span class="pun">]</span><span class="pln"> </span><span class="pun">❇</span><span class="pln">
</span><span class="lit">41</span><span class="pun">:</span><span class="lit">54</span><span class="pln">  INFO </span><span class="pun">(</span><span class="pln">MKS</span><span class="pun">-</span><span class="lit">8</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Proctor</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Blessing</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> shards </span><span class="pun">[</span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">1.102</span><span class="pun">:</span><span class="lit">9000</span><span class="pun">]</span><span class="pln">
</span><span class="lit">41</span><span class="pun">:</span><span class="lit">54</span><span class="pln">  INFO </span><span class="pun">(</span><span class="pln">MKS</span><span class="pun">-</span><span class="lit">8</span><span class="pun">)</span><span class="pln"> </span><span class="pun">————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————</span><span class="pln">
</span><span class="lit">41</span><span class="pun">:</span><span class="lit">54</span><span class="pln">  INFO </span><span class="pun">(</span><span class="pln">MKS</span><span class="pun">-</span><span class="lit">8</span><span class="pun">)</span><span class="pln"> </span><span class="pun">————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————</span><span class="pln">
</span><span class="lit">41</span><span class="pun">:</span><span class="lit">54</span><span class="pln">  INFO </span><span class="pun">(</span><span class="pln">MKS</span><span class="pun">-</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬</span><span class="pln"> </span><span class="typ">Distributor</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i1 </span><span class="kwd">by</span><span class="pln"> </span><span class="typ">Leader</span><span class="pun">:</span><span class="pln"> </span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">1.102</span><span class="pun">:</span><span class="lit">9000</span><span class="pln"> </span><span class="pun">▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬▬</span><span class="pln">
</span><span class="lit">41</span><span class="pun">:</span><span class="lit">54</span><span class="pln">  INFO </span><span class="pun">(</span><span class="pln">MKS</span><span class="pun">-</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="typ">PartitionTable</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">no</span><span class="pln"> CRUD duties
</span><span class="lit">41</span><span class="pun">:</span><span class="lit">54</span><span class="pln">  INFO </span><span class="pun">(</span><span class="pln">MKS</span><span class="pun">-</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="typ">PartitionTable</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Health</span><span class="pun">:</span><span class="pln"> STABLE
</span><span class="lit">41</span><span class="pun">:</span><span class="lit">54</span><span class="pln">  INFO </span><span class="pun">(</span><span class="pln">MKS</span><span class="pun">-</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Distributor</span><span class="pun">:</span><span class="pln"> </span><span class="typ">PartitionMaster</span><span class="pln"> reported </span><span class="lit">450</span><span class="pln"> entities </span><span class="kwd">for</span><span class="pln"> sharding</span><span class="pun">...</span><span class="pln">
</span><span class="lit">41</span><span class="pun">:</span><span class="lit">54</span><span class="pln">  INFO </span><span class="pun">(</span><span class="pln">MKS</span><span class="pun">-</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Bookkeeper</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Adding</span><span class="pln"> </span><span class="typ">New</span><span class="pln"> </span><span class="typ">Pallet</span><span class="pun">:</span><span class="pln"> p</span><span class="pun">:</span><span class="typ">Finwe</span><span class="pln"> ev</span><span class="pun">:</span><span class="pln">C s</span><span class="pun">:</span><span class="pln">PREPARED c</span><span class="pun">:</span><span class="lit">2016</span><span class="pun">-</span><span class="lit">12</span><span class="pun">-</span><span class="lit">10T05</span><span class="pun">:</span><span class="lit">41</span><span class="pun">:</span><span class="lit">54.667Z</span><span class="pln"> </span><span class="kwd">with</span><span class="pln"> </span><span class="typ">Balancer</span><span class="pun">:</span><span class="pln"> </span><span class="typ">FairWeight</span><span class="pun">-</span><span class="typ">PreSort</span><span class="pun">:</span><span class="pln">DATE</span><span class="pun">-</span><span class="typ">Dispersion</span><span class="pun">:</span><span class="pln">EVEN
</span><span class="lit">41</span><span class="pun">:</span><span class="lit">54</span><span class="pln">  INFO </span><span class="pun">(</span><span class="pln">MKS</span><span class="pun">-</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Bookkeeper</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Adding</span><span class="pln"> </span><span class="typ">New</span><span class="pln"> </span><span class="typ">Pallet</span><span class="pun">:</span><span class="pln"> p</span><span class="pun">:</span><span class="typ">Cirith</span><span class="pln"> ev</span><span class="pun">:</span><span class="pln">C s</span><span class="pun">:</span><span class="pln">PREPARED c</span><span class="pun">:</span><span class="lit">2016</span><span class="pun">-</span><span class="lit">12</span><span class="pun">-</span><span class="lit">10T05</span><span class="pun">:</span><span class="lit">41</span><span class="pun">:</span><span class="lit">54.667Z</span><span class="pln"> </span><span class="kwd">with</span><span class="pln"> </span><span class="typ">Balancer</span><span class="pun">:</span><span class="pln"> </span><span class="typ">EvenSize</span><span class="pun">-</span><span class="typ">MaxDutiesDeltaBetweenShards</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
</span><span class="lit">41</span><span class="pun">:</span><span class="lit">54</span><span class="pln">  INFO </span><span class="pun">(</span><span class="pln">MKS</span><span class="pun">-</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Bookkeeper</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Adding</span><span class="pln"> </span><span class="typ">New</span><span class="pln"> </span><span class="typ">Pallet</span><span class="pun">:</span><span class="pln"> p</span><span class="pun">:</span><span class="typ">Manwe</span><span class="pln"> ev</span><span class="pun">:</span><span class="pln">C s</span><span class="pun">:</span><span class="pln">PREPARED c</span><span class="pun">:</span><span class="lit">2016</span><span class="pun">-</span><span class="lit">12</span><span class="pun">-</span><span class="lit">10T05</span><span class="pun">:</span><span class="lit">41</span><span class="pun">:</span><span class="lit">54.668Z</span><span class="pln"> </span><span class="kwd">with</span><span class="pln"> </span><span class="typ">Balancer</span><span class="pun">:</span><span class="pln"> </span><span class="typ">FairWeight</span><span class="pun">-</span><span class="typ">PreSort</span><span class="pun">:</span><span class="pln">DATE</span><span class="pun">-</span><span class="typ">Dispersion</span><span class="pun">:</span><span class="pln">EVEN
</span><span class="lit">41</span><span class="pun">:</span><span class="lit">54</span><span class="pln">  INFO </span><span class="pun">(</span><span class="pln">MKS</span><span class="pun">-</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Bookkeeper</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Adding</span><span class="pln"> </span><span class="typ">New</span><span class="pln"> </span><span class="typ">Duty</span><span class="pun">:</span><span class="pln"> p</span><span class="pun">:</span><span class="typ">Manwe</span><span class="pln"> d</span><span class="pun">:</span><span class="lit">430</span><span class="pln"> w</span><span class="pun">:</span><span class="lit">515.0</span><span class="pln"> ev</span><span class="pun">:</span><span class="pln">C s</span><span class="pun">:</span><span class="pln">PREPARED c</span><span class="pun">:</span><span class="lit">2016</span><span class="pun">-</span><span class="lit">12</span><span class="pun">-</span><span class="lit">10T05</span><span class="pun">:</span><span class="lit">41</span><span class="pun">:</span><span class="lit">54.668Z</span><span class="pln">
</span><span class="lit">41</span><span class="pun">:</span><span class="lit">54</span><span class="pln">  INFO </span><span class="pun">(</span><span class="pln">MKS</span><span class="pun">-</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Bookkeeper</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Adding</span><span class="pln"> </span><span class="typ">New</span><span class="pln"> </span><span class="typ">Duty</span><span class="pun">:</span><span class="pln"> p</span><span class="pun">:</span><span class="typ">Manwe</span><span class="pln"> d</span><span class="pun">:</span><span class="lit">310</span><span class="pln"> w</span><span class="pun">:</span><span class="lit">84.0</span><span class="pln"> ev</span><span class="pun">:</span><span class="pln">C s</span><span class="pun">:</span><span class="pln">PREPARED c</span><span class="pun">:</span><span class="lit">2016</span><span class="pun">-</span><span class="lit">12</span><span class="pun">-</span><span class="lit">10T05</span><span class="pun">:</span><span class="lit">41</span><span class="pun">:</span><span class="lit">54.668Z</span><span class="pln">
</span><span class="lit">41</span><span class="pun">:</span><span class="lit">54</span><span class="pln">  INFO </span><span class="pun">(</span><span class="pln">MKS</span><span class="pun">-</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Bookkeeper</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Adding</span><span class="pln"> </span><span class="typ">New</span><span class="pln"> </span><span class="typ">Duty</span><span class="pun">:</span><span class="pln"> p</span><span class="pun">:</span><span class="typ">Manwe</span><span class="pln"> d</span><span class="pun">:</span><span class="lit">431</span><span class="pln"> w</span><span class="pun">:</span><span class="lit">484.0</span><span class="pln"> ev</span><span class="pun">:</span><span class="pln">C s</span><span class="pun">:</span><span class="pln">PREPARED c</span><span class="pun">:</span><span class="lit">2016</span><span class="pun">-</span><span class="lit">12</span><span class="pun">-</span><span class="lit">10T05</span><span class="pun">:</span><span class="lit">41</span><span class="pun">:</span><span class="lit">54.669Z</span><span class="pln">
</span><span class="lit">41</span><span class="pun">:</span><span class="lit">54</span><span class="pln">  INFO </span><span class="pun">(</span><span class="pln">MKS</span><span class="pun">-</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Bookkeeper</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Adding</span><span class="pln"> </span><span class="typ">New</span><span class="pln"> </span><span class="typ">Duty</span><span class="pun">:</span><span class="pln"> p</span><span class="pun">:</span><span class="typ">Manwe</span><span class="pln"> d</span><span class="pun">:</span><span class="lit">311</span><span class="pln"> w</span><span class="pun">:</span><span class="lit">532.0</span><span class="pln"> ev</span><span class="pun">:</span><span class="pln">C s</span><span class="pun">:</span><span class="pln">PREPARED c</span><span class="pun">:</span><span class="lit">2016</span><span class="pun">-</span><span class="lit">12</span><span class="pun">-</span><span class="lit">10T05</span><span class="pun">:</span><span class="lit">41</span><span class="pun">:</span><span class="lit">54.669Z</span></code></pre>

<p>And the status</p>



<pre class="prettyprint prettyprinted"><code><span class="pun">{</span><span class="pln">
  </span><span class="str">"roadmaps"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
      </span><span class="str">"ended"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"2016-12-10T05:52:37.428Z"</span><span class="pun">,</span><span class="pln">
      </span><span class="str">"started"</span><span class="pun">:</span><span class="pln"> </span><span class="str">""</span><span class="pun">,</span><span class="pln">
      </span><span class="str">"created"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"2016-12-10T05:52:36.516Z"</span><span class="pun">,</span><span class="pln">
      </span><span class="str">"deliveries"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[],</span><span class="pln">
      </span><span class="str">"empty"</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">,</span><span class="pln">
      </span><span class="str">"retryCount"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"0"</span><span class="pun">,</span><span class="pln">
      </span><span class="str">"id"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"3"</span><span class="pun">,</span><span class="pln">
      </span><span class="str">"capacityStatus"</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
    </span><span class="pun">},</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
      </span><span class="str">"ended"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"2016-12-10T05:52:33.396Z"</span><span class="pun">,</span><span class="pln">
      </span><span class="str">"started"</span><span class="pun">:</span><span class="pln"> </span><span class="str">""</span><span class="pun">,</span><span class="pln">
      </span><span class="str">"created"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"2016-12-10T05:52:31.457Z"</span><span class="pun">,</span><span class="pln">
      </span><span class="str">"deliveries"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[],</span><span class="pln">
      </span><span class="str">"empty"</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">,</span><span class="pln">
      </span><span class="str">"retryCount"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"0"</span><span class="pun">,</span><span class="pln">
      </span><span class="str">"id"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"2"</span><span class="pun">,</span><span class="pln">
      </span><span class="str">"capacityStatus"</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
  </span><span class="pun">],</span><span class="pln">
  </span><span class="str">"global"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="str">"unstaged-size"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"109"</span><span class="pun">,</span><span class="pln">
    </span><span class="str">"staged-size"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"341"</span><span class="pun">,</span><span class="pln">
    </span><span class="str">"pallet-size"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"3"</span><span class="pun">,</span><span class="pln">
    </span><span class="str">"duty-size"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"450"</span><span class="pun">,</span><span class="pln">
    </span><span class="str">"shard-size"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"1"</span><span class="pln">
  </span><span class="pun">},</span><span class="pln">
  </span><span class="str">"pallets"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
      </span><span class="str">"balancer"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"io.tilt.minka.core.leader.balancer.FairWeightBalancer"</span><span class="pun">,</span><span class="pln">
      </span><span class="str">"balancer-metadata"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="str">"dispersion"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"EVEN"</span><span class="pun">,</span><span class="pln">
        </span><span class="str">"presort"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"DATE"</span><span class="pln">
      </span><span class="pun">},</span><span class="pln">
      </span><span class="str">"unstaged-weight"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"0.0"</span><span class="pun">,</span><span class="pln">
      </span><span class="str">"id"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"Finwe"</span><span class="pun">,</span><span class="pln">
      </span><span class="str">"creation"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"2016-12-10T05:52:31.430Z"</span><span class="pun">,</span><span class="pln">
      </span><span class="str">"size"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"200"</span><span class="pun">,</span><span class="pln">
      </span><span class="str">"cluster-capacity"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"15000.0"</span><span class="pun">,</span><span class="pln">
      </span><span class="str">"allocation"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"400%"</span><span class="pun">,</span><span class="pln">
      </span><span class="str">"staged-size"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"200"</span><span class="pun">,</span><span class="pln">
      </span><span class="str">"staged-weight"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"12680.0"</span><span class="pun">,</span><span class="pln">
      </span><span class="str">"unstaged-size"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"0"</span><span class="pln">
    </span><span class="pun">},</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
      </span><span class="str">"balancer"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"io.tilt.minka.core.leader.balancer.EvenSizeBalancer"</span><span class="pun">,</span><span class="pln">
      </span><span class="str">"balancer-metadata"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="str">"maxDutiesDeltaBetweenShards"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"1"</span><span class="pln">
      </span><span class="pun">},</span><span class="pln">
      </span><span class="str">"unstaged-weight"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"0.0"</span><span class="pun">,</span><span class="pln">
      </span><span class="str">"id"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"Cirith"</span><span class="pun">,</span><span class="pln">
      </span><span class="str">"creation"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"2016-12-10T05:52:31.431Z"</span><span class="pun">,</span><span class="pln">
      </span><span class="str">"size"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"100"</span><span class="pun">,</span><span class="pln">
      </span><span class="str">"cluster-capacity"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"0.0"</span><span class="pun">,</span><span class="pln">
      </span><span class="str">"allocation"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"100%"</span><span class="pun">,</span><span class="pln">
      </span><span class="str">"staged-size"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"100"</span><span class="pun">,</span><span class="pln">
      </span><span class="str">"staged-weight"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"100.0"</span><span class="pun">,</span><span class="pln">
      </span><span class="str">"unstaged-size"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"0"</span><span class="pln">
    </span><span class="pun">},</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
      </span><span class="str">"balancer"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"io.tilt.minka.core.leader.balancer.FairWeightBalancer"</span><span class="pun">,</span><span class="pln">
      </span><span class="str">"balancer-metadata"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="str">"dispersion"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"EVEN"</span><span class="pun">,</span><span class="pln">
        </span><span class="str">"presort"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"DATE"</span><span class="pln">
      </span><span class="pun">},</span><span class="pln">
      </span><span class="str">"unstaged-weight"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"57866.0"</span><span class="pun">,</span><span class="pln">
      </span><span class="str">"id"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"Manwe"</span><span class="pun">,</span><span class="pln">
      </span><span class="str">"creation"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"2016-12-10T05:52:31.431Z"</span><span class="pun">,</span><span class="pln">
      </span><span class="str">"size"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"150"</span><span class="pun">,</span><span class="pln">
      </span><span class="str">"cluster-capacity"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"16000.0"</span><span class="pun">,</span><span class="pln">
      </span><span class="str">"allocation"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"61%"</span><span class="pun">,</span><span class="pln">
      </span><span class="str">"staged-size"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"41"</span><span class="pun">,</span><span class="pln">
      </span><span class="str">"staged-weight"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"15978.0"</span><span class="pun">,</span><span class="pln">
      </span><span class="str">"unstaged-size"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"109"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
  </span><span class="pun">],</span><span class="pln">
  </span><span class="str">"shards"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
      </span><span class="str">"pallets"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
        </span><span class="pun">{</span><span class="pln">
          </span><span class="str">"duties"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"100:75.0,101:50.0,102:70.0,103:65.0,104:70.0,105:50.0,106:50.0,107:81.0,108:50.0,109:50.0,110:98.0,111:98.0,112:50.0,113:53.0,114:50.0,115:50.0,116:50.0,117:77.0,118:97.0,119:56.0,10:51.0,11:74.0,12:50.0,13:65.0,14:50.0,15:90.0,16:94.0,17:63.0,18:50.0,19:95.0,120:50.0,0:97.0,121:50.0,1:50.0,122:84.0,123:75.0,2:50.0,124:62.0,3:50.0,125:87.0,4:90.0,126:50.0,5:72.0,127:50.0,6:50.0,128:50.0,7:83.0,129:57.0,8:84.0,9:74.0,20:79.0,21:50.0,22:95.0,23:50.0,24:57.0,25:50.0,26:71.0,27:88.0,28:50.0,29:58.0,130:94.0,131:72.0,132:80.0,133:50.0,134:50.0,135:50.0,136:54.0,137:56.0,138:50.0,139:52.0,30:50.0,31:55.0,32:50.0,33:81.0,34:70.0,35:90.0,36:50.0,37:61.0,38:50.0,39:50.0,140:76.0,141:97.0,142:71.0,143:62.0,144:70.0,145:50.0,146:50.0,147:85.0,148:50.0,149:50.0,40:63.0,41:50.0,42:84.0,43:50.0,44:66.0,45:50.0,46:76.0,47:78.0,48:73.0,49:53.0,150:93.0,151:50.0,152:92.0,153:95.0,154:50.0,155:50.0,156:75.0,157:51.0,158:75.0,159:64.0,50:50.0,51:88.0,52:67.0,53:89.0,54:88.0,55:50.0,56:71.0,57:69.0,58:58.0,59:58.0,160:81.0,161:78.0,162:98.0,163:50.0,164:50.0,165:60.0,166:50.0,167:79.0,168:63.0,169:50.0,60:73.0,61:50.0,62:50.0,63:50.0,64:92.0,65:50.0,66:94.0,67:50.0,68:71.0,69:50.0,170:50.0,171:52.0,172:50.0,173:67.0,174:65.0,175:50.0,176:50.0,177:50.0,178:97.0,179:59.0,70:50.0,71:86.0,72:92.0,73:50.0,74:58.0,75:95.0,76:50.0,77:50.0,78:50.0,79:50.0,180:50.0,181:58.0,182:50.0,183:50.0,184:50.0,185:70.0,186:58.0,187:53.0,188:55.0,189:79.0,80:50.0,81:67.0,82:50.0,83:50.0,84:50.0,85:72.0,86:50.0,87:73.0,88:50.0,89:86.0,190:50.0,191:59.0,192:50.0,193:65.0,194:50.0,195:97.0,196:50.0,197:50.0,198:50.0,199:50.0,90:50.0,91:91.0,92:50.0,93:50.0,94:50.0,95:60.0,96:50.0,97:50.0,98:90.0,99:50.0,"</span><span class="pun">,</span><span class="pln">
          </span><span class="str">"weight"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"12680.0"</span><span class="pun">,</span><span class="pln">
          </span><span class="str">"capacity"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"15000.0"</span><span class="pun">,</span><span class="pln">
          </span><span class="str">"size"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"200"</span><span class="pun">,</span><span class="pln">
          </span><span class="str">"id"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"Finwe"</span><span class="pln">
        </span><span class="pun">},</span><span class="pln">
        </span><span class="pun">{</span><span class="pln">
          </span><span class="str">"duties"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"270:1.0,271:1.0,272:1.0,273:1.0,274:1.0,275:1.0,276:1.0,277:1.0,278:1.0,279:1.0,280:1.0,281:1.0,282:1.0,283:1.0,284:1.0,285:1.0,286:1.0,287:1.0,200:1.0,288:1.0,201:1.0,289:1.0,202:1.0,203:1.0,204:1.0,205:1.0,206:1.0,207:1.0,208:1.0,209:1.0,290:1.0,291:1.0,292:1.0,293:1.0,294:1.0,295:1.0,296:1.0,297:1.0,210:1.0,298:1.0,211:1.0,299:1.0,212:1.0,213:1.0,214:1.0,215:1.0,216:1.0,217:1.0,218:1.0,219:1.0,220:1.0,221:1.0,222:1.0,223:1.0,224:1.0,225:1.0,226:1.0,227:1.0,228:1.0,229:1.0,230:1.0,231:1.0,232:1.0,233:1.0,234:1.0,235:1.0,236:1.0,237:1.0,238:1.0,239:1.0,240:1.0,241:1.0,242:1.0,243:1.0,244:1.0,245:1.0,246:1.0,247:1.0,248:1.0,249:1.0,250:1.0,251:1.0,252:1.0,253:1.0,254:1.0,255:1.0,256:1.0,257:1.0,258:1.0,259:1.0,260:1.0,261:1.0,262:1.0,263:1.0,264:1.0,265:1.0,266:1.0,267:1.0,268:1.0,269:1.0,"</span><span class="pun">,</span><span class="pln">
          </span><span class="str">"weight"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"100.0"</span><span class="pun">,</span><span class="pln">
          </span><span class="str">"capacity"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"0.0"</span><span class="pun">,</span><span class="pln">
          </span><span class="str">"size"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"100"</span><span class="pun">,</span><span class="pln">
          </span><span class="str">"id"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"Cirith"</span><span class="pln">
        </span><span class="pun">},</span><span class="pln">
        </span><span class="pun">{</span><span class="pln">
          </span><span class="str">"duties"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"330:108.0,430:585.0,310:160.0,431:56.0,311:967.0,432:822.0,312:50.0,433:824.0,313:959.0,335:77.0,434:710.0,314:679.0,336:112.0,435:136.0,315:52.0,436:235.0,316:503.0,338:137.0,437:51.0,317:395.0,438:869.0,318:826.0,439:484.0,319:190.0,440:963.0,320:431.0,441:73.0,321:518.0,442:95.0,322:103.0,443:66.0,323:775.0,444:366.0,324:381.0,445:134.0,325:90.0,446:50.0,326:492.0,327:151.0,328:989.0,329:314.0,"</span><span class="pun">,</span><span class="pln">
          </span><span class="str">"weight"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"15978.0"</span><span class="pun">,</span><span class="pln">
          </span><span class="str">"capacity"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"16000.0"</span><span class="pun">,</span><span class="pln">
          </span><span class="str">"size"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"41"</span><span class="pun">,</span><span class="pln">
          </span><span class="str">"id"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"Manwe"</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
      </span><span class="pun">],</span><span class="pln">
      </span><span class="str">"status"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"ONLINE"</span><span class="pun">,</span><span class="pln">
      </span><span class="str">"creation"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"2016-12-10T05:52:10.449Z"</span><span class="pun">,</span><span class="pln">
      </span><span class="str">"host"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"2.168.1.10:9000"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
  </span><span class="pun">]</span><span class="pln">
</span><span class="pun">}</span></code></pre>

<iframe src="//pastebin.com/embed_iframe/W8M5GbWE"></iframe></div></body>
</html>